<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>币联CoinLinkPC-1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .page { display: none; padding: 2rem; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Sidebar Styles */
        .sidebar { transition: width 0.3s; }
        .sidebar-item a { display: flex; align-items: center; padding: 12px 16px; border-radius: 8px; color: #d1d5db; transition: background-color 0.2s, color 0.2s; font-size: 15px; }
        .sidebar-item a:hover { background-color: #374151; color: #ffffff; }
        .sidebar-item a.active { background-color: #4f46e5; color: #ffffff; font-weight: 600; }
        .sidebar-item a.active-parent { background-color: #374151; color: #ffffff; }
        .sidebar-item a i { margin-right: 12px; }
        .submenu { display: none; margin-top: 0.25rem; }
        .submenu a { font-size: 14px; padding-top: 8px; padding-bottom: 8px; padding-left: 3.25rem; }
        .submenu a.active { background-color: #4338ca; color: #ffffff; font-weight: 500; }
        .sidebar-item.open > .submenu { display: block; }
        .chevron-icon { transition: transform 0.3s; }
        .sidebar-item.open .chevron-icon { transform: rotate(180deg); }

        /* General Styles */
        .pm-comment { background-color: #fffbeb; border-left: 4px solid #facc15; padding: 12px 16px; border-radius: 4px; color: #78350f; margin-bottom: 1.5rem; font-size: 14px; }
        .custom-table { width: 100%; border-collapse: collapse; }
        .custom-table th, .custom-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 14px; white-space:nowrap; }
        .custom-table th { background-color: #f9fafb; color: #4b5563; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .custom-table th:hover { background-color: #f3f4f6; cursor: pointer; }
        .custom-table tbody tr:hover { background-color: #f9fafb; }
        .badge { display: inline-block; padding: 4px 10px; font-size: 12px; font-weight: 500; border-radius: 9999px; }
        .badge-green { background-color: #dcfce7; color: #166534; }
        .badge-red { background-color: #fee2e2; color: #991b1b; }
        .badge-yellow { background-color: #fef9c3; color: #854d0e; }
        .badge-blue { background-color: #dbeafe; color: #1e40af; }
        .badge-purple { background-color: #ede9fe; color: #5b21b6; }
        .badge-orange { background-color: #ffedd5; color: #9a3412; }
        .badge-gray { background-color: #e5e7eb; color: #374151; }
        .badge-cyan { background-color: #cffafe; color: #0e7490; }
        
        /* Permission Tree Style */
        .permission-tree ul { padding-left: 1.5rem; }
        .permission-tree li { margin-top: 0.75rem; }
        .permission-tree .module-name { font-weight: 600; color: #1f2937; }
        .permission-tree .page-name { font-weight: 500; color: #374151; }
        .permission-tree .actions-list { display: flex; flex-wrap: wrap; gap: 1.5rem; padding-left: 1rem; margin-top: 0.5rem; color: #6b7280; }
        .permission-tree input[type=checkbox] { width: 1rem; height: 1rem; accent-color: #4f46e5; }
        .permission-tree input[type=checkbox]:disabled { accent-color: #9ca3af; }
        
        /* Custom Switch Toggle */
        .switch { position: relative; display: inline-block; width: 40px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4f46e5; }
        input:checked + .slider:before { transform: translateX(16px); }

        /* Modal & Content Styles */
        .modal-content-area { overflow-y: auto; }
        .table-description, .table-content { max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
        .template-content-preview, .push-content-preview { max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #6b7280; }
        #templateEditorModal .ql-editor, #richTextConfigModal .ql-editor, #announcementModal .ql-editor { min-height: 400px; }
        .variable-tag { background-color: #eef2ff; color: #4f46e5; padding: 4px 8px; border-radius: 4px; font-family: monospace; cursor: pointer; transition: background-color 0.2s; }
        .variable-tag:hover { background-color: #e0e7ff; }
        .detail-table { border: 1px solid #e5e7eb; border-collapse: collapse; width: 100%; }
        .detail-table td { border: 1px solid #e5e7eb; padding: 8px 12px; font-size: 14px; }
        .detail-table .label { background-color: #f9fafb; font-weight: 500; color: #4b5563; text-align: right; width: 15%; }
        .detail-table .value { width: 35%; }
        .trader-detail-grid { display: grid; grid-template-columns: repeat(4, auto 1fr); gap: 0.5rem 1.5rem; }
        .trader-detail-grid dt { font-weight: 500; color: #4b5563; text-align: right; white-space: nowrap; }
        .trader-detail-grid dd { color: #1f2937; }

        /* Tab Styles */
        .tab-button { padding: 8px 16px; font-size: 16px; font-weight: 600; border-bottom: 3px solid transparent; color: #6b7280; cursor: pointer; transition: all 0.2s; }
        .tab-button:hover { color: #1f2937; }
        .tab-button.active { color: #4f46e5; border-bottom-color: #4f46e5; }
        .tab-pane { display: none; animation: fadeIn 0.5s; }
        .tab-pane.active { display: block; }

        /* Dropdown */
        .dropdown-menu a {
            transition: background-color 0.2s, color 0.2s;
        }
    </style>
</head>
<body>

    <div id="login-page" class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-2">币联后台系统</h2>
            <p class="text-center text-gray-500 mb-8">欢迎回来，请登录您的账户</p>
            <form onsubmit="event.preventDefault(); login();">
                <div class="mb-4"><label for="username" class="block text-gray-700 text-sm font-bold mb-2">账号</label><input type="text" id="username" name="username" placeholder="请输入您的账号" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" value="admin_manager"></div>
                <div class="mb-6"><label for="password" class="block text-gray-700 text-sm font-bold mb-2">密码</label><input type="password" id="password" name="password" placeholder="请输入您的密码" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" value="password123"></div>
                <div class="mb-6 flex items-center gap-4"><div class="flex-grow"><label for="captcha" class="block text-gray-700 text-sm font-bold mb-2">验证码</label><input type="text" id="captcha" name="captcha" placeholder="请输入验证码" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" value="r8xT"></div><div class="flex-shrink-0 mt-7"><img src="https://via.placeholder.com/100x40.png?text=r8xT" alt="验证码" class="rounded-lg h-10 cursor-pointer" onclick="alert('刷新验证码')"></div></div>
                <div class="mb-4"><button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:shadow-outline">登 录</button></div>
            </form>
        </div>
    </div>

    <div id="app-container" class="flex h-screen w-full" style="display: none;">
        <aside class="sidebar w-64 bg-gray-900 text-white p-4 flex flex-col flex-shrink-0">
            <div class="text-center py-4 border-b border-gray-700"><h1 class="text-2xl font-bold">币联后台</h1></div>
            <nav id="sidebar-nav" class="flex-grow mt-6 space-y-1 overflow-y-auto">
                <div class="sidebar-item"><a href="#" class="sidebar-link active" onclick="showPage('dashboard', this)"><i data-lucide="layout-dashboard"></i><span>仪表盘</span></a></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="showPage('users', this)"><i data-lucide="users"></i><span>客户管理</span></a></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="toggleSubmenu(this)"><i data-lucide="trending-up"></i><span>操盘手管理</span><i data-lucide="chevron-down" class="ml-auto chevron-icon"></i></a><div class="submenu space-y-1"><a href="#" onclick="showPage('trader-list', this)">操盘手列表</a><a href="#" onclick="showPage('trader-applications', this)">入驻审核 <span class="ml-2 text-xs text-red-400">(2)</span></a></div></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="toggleSubmenu(this)"><i data-lucide="file-text"></i><span>合同管理</span><i data-lucide="chevron-down" class="ml-auto chevron-icon"></i></a><div class="submenu space-y-1"><a href="#" onclick="showPage('contract-list', this)">合同列表</a><a href="#" onclick="showPage('contract-templates', this)">合同模板管理</a></div></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="toggleSubmenu(this)"><i data-lucide="receipt"></i><span>收益管理</span><i data-lucide="chevron-down" class="ml-auto chevron-icon"></i></a><div class="submenu space-y-1"><a href="#" onclick="showPage('settle-overview', this)">平台收益总览</a><a href="#" onclick="showPage('settle-customer', this)">客户收益结算</a><a href="#" onclick="showPage('settle-trader', this)">操盘手收益结算</a></div></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="toggleSubmenu(this)"><i data-lucide="settings"></i><span>系统配置</span><i data-lucide="chevron-down" class="ml-auto chevron-icon"></i></a><div class="submenu space-y-1"><a href="#" onclick="showPage('settings-accounts', this)">账号管理</a><a href="#" onclick="showPage('settings-roles-mgmt', this)">角色管理</a><a href="#" onclick="showPage('settings-sms-channels', this)">短信渠道配置</a><a href="#" onclick="showPage('settings-sms-app', this)">APP短信配置</a><a href="#" onclick="showPage('settings-app', this)">APP配置</a><a href="#" onclick="showPage('settings-content', this)">消息管理</a></div></div>
                <div class="sidebar-item"><a href="#" class="sidebar-link" onclick="toggleSubmenu(this)"><i data-lucide="shield"></i><span>风控与日志</span><i data-lucide="chevron-down" class="ml-auto chevron-icon"></i></a><div class="submenu space-y-1"><a href="#" onclick="showPage('risk-monitor', this)">异常交易监控 <span class="ml-2 text-xs text-red-400">(1)</span></a><a href="#" onclick="showPage('risk-api', this)">API Key监控</a><a href="#" onclick="showPage('risk-logs', this)">操作日志</a></div></div>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col">
            <header class="flex-shrink-0 bg-white border-b shadow-sm">
                <div class="flex items-center justify-end h-16 px-6 space-x-6">
                    <button class="relative text-gray-600 hover:text-gray-900 focus:outline-none">
                        <i data-lucide="bell"></i>
                        <span class="absolute -top-1 -right-1 flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                        </span>
                    </button>
                    <div class="relative" id="user-dropdown-container">
                        <button id="user-dropdown-toggle" onclick="toggleUserDropdown()" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 focus:outline-none">
                            <i data-lucide="user-circle" class="w-8 h-8 text-gray-500"></i>
                            <span class="font-medium text-sm">admin_manager</span>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div id="user-dropdown-menu" class="dropdown-menu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
                             <a href="#" onclick="logout(event)" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900">
                                <i data-lucide="log-out" class="w-4 h-4 mr-3"></i>
                                <span>退出登录</span>
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <main class="flex-grow overflow-y-auto">
                <div id="dashboard" class="page" style="display: block;">
                    <h1 class="text-2xl font-bold text-gray-800">仪表盘</h1>
                    <!-- <div class="pm-comment mt-6"><strong>产品经理注 (需求4.1)：</strong>为平台管理员提供“驾驶舱”，30秒内快速掌握核心运营状态、财务健康度及紧急待办事项。</div> -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6">
                        <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">管理总资产 (AUM)</p><p class="text-3xl font-bold text-gray-800">$1,283,450</p></div>
                        <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">24小时总盈亏</p><p class="text-3xl font-bold text-green-600">+$12,530</p></div>
                        <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">生效中合同数</p><p class="text-3xl font-bold text-gray-800">342</p></div>
                        <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">待处理事项总数</p><p class="text-3xl font-bold text-red-600">11</p></div>
                    </div>
                     <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">AUM增长曲线 (30天)</h2>
                            <div style="height:320px;"><canvas id="aumTrendChart"></canvas></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-md">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">待办事项详情区</h2>
                            <ul class="space-y-4">
                                <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><div><p class="font-medium text-gray-800">待审核支付凭证</p></div><span class="font-bold text-indigo-600">3</span></li>
                                <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><div><p class="font-medium text-gray-800">待审批操盘手入驻</p></div><span class="font-bold text-indigo-600">2</span></li>
                                <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><div><p class="font-medium text-gray-800">待签署/续签合同</p></div><span class="font-bold text-indigo-600">5</span></li>
                                <li class="flex items-center justify-between p-3 bg-red-50 rounded-lg hover:bg-red-100 cursor-pointer"><div><p class="font-medium text-red-800">异常交易警报</p></div><span class="font-bold text-red-600">1</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="users" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">客户管理</h1>
                    <!-- <div class="pm-comment mt-6"><strong>产品经理注 (需求4.2)：</strong>提供一个完整的客户信息与关系管理中心，便于操盘手管理客户委托合同以及管理敏感信息（如API Key）。</div> -->
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><input type="text" placeholder="用户ID / 手机号 / 姓名" class="col-span-1 border rounded-lg px-4 py-2 w-full outline-none focus:ring-2 focus:ring-indigo-500"><select class="col-span-1 border rounded-lg px-4 py-2 w-full outline-none focus:ring-2 focus:ring-indigo-500"><option value="">全部合同状态</option><option>生效中</option><option>已失效</option><option>已解除</option></select><select class="col-span-1 border rounded-lg px-4 py-2 w-full outline-none focus:ring-2 focus:ring-indigo-500"><option value="">全部交易所</option><option>币安</option><option>欧易</option></select><select class="col-span-1 border rounded-lg px-4 py-2 w-full outline-none focus:ring-2 focus:ring-indigo-500"><option value="">全部操盘手</option><option>稳健猎手</option><option>激进先锋</option><option>趋势之王</option></select></div><div class="mt-4 flex justify-end space-x-2"><button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button></div></div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>委托合同编号</th><th>操盘手</th><th>合同状态</th><th>委托金额(USDT)</th><th>API Key</th><th>Secret Key</th><th>交易所</th><th>累计收益(USDT)</th><th>委托周期</th><th>操作</th></tr></thead><tbody id="customer-table-body"><tr data-api-key="bkCiO...Vb4qE" data-secret-key="pl9kO...tG8wN"><td>CON-2023-001</td><td>稳健猎手</td><td><span class="badge badge-green">生效中</span></td><td>50,000.00</td><td class="api-key-container"><span class="font-mono text-sm">************</span></td><td class="secret-key-container"><span class="font-mono text-sm">************</span></td><td>币安</td><td class="text-green-600">+5,120.50</td><td>2023-01-01 - 2024-01-01</td><td><button class="show-key-btn text-sm text-indigo-600 hover:text-indigo-800 font-semibold">显示Key</button></td></tr><tr data-api-key="zxcVB...AsdFg" data-secret-key="lkjHGF...POiuy"><td>CON-2022-088</td><td>激进先锋</td><td><span class="badge badge-gray">已失效</span></td><td>100,000.00</td><td class="api-key-container"><span class="font-mono text-sm">************</span></td><td class="secret-key-container"><span class="font-mono text-sm">************</span></td><td>欧易</td><td class="text-green-600">+18,450.00</td><td>2022-09-15 - 2023-09-15</td><td><button class="show-key-btn text-sm text-indigo-600 hover:text-indigo-800 font-semibold">显示Key</button></td></tr><tr data-api-key="qweRT...YuiOp" data-secret-key="mnbVC...XZlkj"><td>CON-2023-015</td><td>趋势之王</td><td><span class="badge badge-red">已解约</span></td><td>25,000.00</td><td class="api-key-container"><span class="font-mono text-sm">************</span></td><td class="secret-key-container"><span class="font-mono text-sm">************</span></td><td>币安</td><td class="text-red-600">-2,300.75</td><td>2023-02-10 - 2023-05-10</td><td><button class="show-key-btn text-sm text-indigo-600 hover:text-indigo-800 font-semibold">显示Key</button></td></tr></tbody></table></div>
                </div>
                <div id="trader-list" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">操盘手列表</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md"><div class="flex flex-wrap items-center justify-between gap-4"><div class="flex items-center space-x-2"><input type="text" placeholder="按姓名/昵称/手机号搜索" class="border rounded-lg px-4 py-2 w-64 outline-none focus:ring-2 focus:ring-indigo-500"><select class="border rounded-lg px-4 py-2 w-48 outline-none focus:ring-2 focus:ring-indigo-500"><option value="">所有交易风格</option><option>稳健型</option><option>平衡型</option><option>激进型</option></select><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button></div><button onclick="openTraderModal(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>新增操盘手</button></div></div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table id="trader-table" class="custom-table w-full"><thead><tr><th><div class="flex items-center">序号 <i data-lucide="arrow-up-down" class="ml-1 h-4 w-4"></i></div></th><th><div class="flex items-center">姓名 <i data-lucide="arrow-up-down" class="ml-1 h-4 w-4"></i></div></th><th><div class="flex items-center">推荐排序 <i data-lucide="arrow-up-down" class="ml-1 h-4 w-4"></i></div></th><th><div class="flex items-center">操盘手昵称 <i data-lucide="arrow-up-down" class="ml-1 h-4 w-4"></i></div></th><th>公司</th><th>手机号码</th><th>交易风格</th><th>交易经验(年)</th><th>起投资金(USDT)</th><th>简介</th><th>委托总资产(AUM)</th><th>累计收益</th><th>最大回撤</th><th>委托人数</th><th>审批人</th><th>操作</th></tr></thead><tbody><tr data-trader-id="T01"><td>1</td><td class="trader-name">张伟</td><td class="trader-sort">1</td><td class="trader-nickname">稳健猎手</td><td class="trader-company">-</td><td class="trader-phone">138****1111</td><td class="trader-style">稳健型</td><td class="trader-experience">8</td><td class="trader-min-investment">50000</td><td class="table-description" title="长期价值投资，专注低风险套利与趋势跟踪。">长期价值投资，专注低风险套利与趋势跟踪。</td><td>$570,000</td><td class="text-green-600">+$85,500</td><td>-5.2%</td><td>15</td><td>admin_01</td><td class="space-x-2"><a href="#" class="text-blue-600 hover:underline">查看</a><button class="edit-trader-btn text-indigo-600 hover:underline">编辑</button></td></tr><tr data-trader-id="T02"><td>2</td><td class="trader-name">李娜</td><td class="trader-sort">3</td><td class="trader-nickname">激进先锋</td><td class="trader-company">阿尔法资本</td><td class="trader-phone">139****2222</td><td class="trader-style">激进型</td><td class="trader-experience">5</td><td class="trader-min-investment">100000</td><td class="table-description" title="高频交易，主攻短线波动，追求绝对收益。">高频交易，主攻短线波动，追求绝对收益。</td><td>$410,000</td><td class="text-green-600">+$123,000</td><td>-18.5%</td><td>8</td><td>admin_01</td><td class="space-x-2"><a href="#" class="text-blue-600 hover:underline">查看</a><button class="edit-trader-btn text-indigo-600 hover:underline">编辑</button></td></tr><tr data-trader-id="T03"><td>3</td><td class="trader-name">王强</td><td class="trader-sort">2</td><td class="trader-nickname">趋势之王</td><td class="trader-company">-</td><td class="trader-phone">137****3333</td><td class="trader-style">平衡型</td><td class="trader-experience">10</td><td class="trader-min-investment">80000</td><td class="table-description" title="中长线波段操作，兼顾成长与价值。">中长线波段操作，兼顾成长与价值。</td><td>$300,000</td><td class="text-green-600">+$60,000</td><td>-9.8%</td><td>12</td><td>admin_02</td><td class="space-x-2"><a href="#" class="text-blue-600 hover:underline">查看</a><button class="edit-trader-btn text-indigo-600 hover:underline">编辑</button></td></tr></tbody></table></div>
                </div>
                <div id="trader-applications" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">入驻审核</h1>
                    <div class="border-b border-gray-200 mt-6">
                        <nav class="flex space-x-4" aria-label="Tabs">
                            <button id="tab-btn-pending-review" onclick="switchTraderAppTab('pending-review')" class="tab-button active">待审核 (2)</button>
                            <button id="tab-btn-review-history" onclick="switchTraderAppTab('review-history')" class="tab-button">审核记录</button>
                        </nav>
                    </div>
                    <div id="tab-pane-pending-review" class="tab-pane active mt-6">
                        <div class="bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>申请时间</th><th>姓名</th><th>手机号</th><th>交易风格</th><th>交易经验</th><th>起投资金</th><th>简介</th><th>操作</th></tr></thead><tbody><tr><td>2024-06-10 14:00</td><td>王大力</td><td>139****0001</td><td>激进型</td><td>5年</td><td>50万 USDT</td><td class="table-description" title="短线高频交易，熟悉各类技术指标，风控意识强。">短线高频...</td><td class="space-x-2"><a href="#" class="text-green-600 hover:underline">通过</a><a href="#" class="text-red-600 hover:underline">拒绝</a><a href="#" class="text-indigo-600 hover:underline">详情</a></td></tr><tr><td>2024-06-09 11:30</td><td>陈思</td><td>137****1122</td><td>稳健型</td><td>8年</td><td>80万 USDT</td><td class="table-description" title="专注主流币种低风险套利和中长线价值投资。">专注主流...</td><td class="space-x-2"><a href="#" class="text-green-600 hover:underline">通过</a><a href="#" class="text-red-600 hover:underline">拒绝</a><a href="#" class="text-indigo-600 hover:underline">详情</a></td></tr></tbody></table></div>
                    </div>
                    <div id="tab-pane-review-history" class="tab-pane mt-6">
                         <div class="bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>申请时间</th><th>姓名</th><th>手机号</th><th>审核结果</th><th>审核人</th><th>审核时间</th><th>操作</th></tr></thead><tbody><tr><td>2024-06-08 09:00</td><td>李军</td><td>158****9999</td><td><span class="badge badge-green">已通过</span></td><td>admin_manager</td><td>2024-06-08 15:30</td><td><a href="#" class="text-indigo-600 hover:underline">详情</a></td></tr><tr><td>2024-06-07 17:20</td><td>赵飞</td><td>136****8888</td><td><span class="badge badge-red">已拒绝</span></td><td>admin_manager</td><td>2024-06-08 11:00</td><td><a href="#" class="text-indigo-600 hover:underline">详情</a></td></tr></tbody></table></div>
                    </div>
                </div>
                <div id="contract-list" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">合同列表</h1>
                    <div class="mt-6 flex items-center space-x-2 bg-white p-4 rounded-xl shadow-md"><input type="text" placeholder="合同编号/客户/操盘手姓名..." class="border rounded-lg px-4 py-2 w-64 outline-none focus:ring-2 focus:ring-indigo-500"><select class="border rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"><option>合同状态</option><option>待签署</option><option>生效中</option><option>已终止</option><option>即将到期</option></select><input type="date" class="border rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"><span class="mx-2 text-gray-500">至</span><input type="date" class="border rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">筛选</button></div>
                    <div class="mt-4 bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>合同编号</th><th>客户信息</th><th>操盘手信息</th><th>委托金额</th><th>分红比例</th><th>合同状态</th><th>签署时间</th><th>到期时间</th><th>操作</th></tr></thead><tbody><tr><td>CON-2023-001</td><td>张三(1001)</td><td>稳健猎手(T01)</td><td>50,000</td><td>30%</td><td><span class="badge badge-green">生效中</span></td><td>2023-01-01</td><td>2024-01-01</td><td><a href="#" class="text-indigo-600 hover:underline">查看/下载PDF</a></td></tr></tbody></table></div>
                </div>
                <div id="contract-templates" class="page">
                    <div class="flex justify-between items-center"><h1 class="text-2xl font-bold text-gray-800">合同模板管理</h1><button onclick="openTemplateEditor(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>创建新模板</button></div>
                     <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
                            <div class="lg:col-span-1">
                                <label class="text-sm font-medium text-gray-700">模板名称</label>
                                <input type="text" placeholder="输入模板名称关键字" class="border rounded-lg px-3 py-2 w-full mt-1">
                            </div>
                            <div class="lg:col-span-1">
                                <label class="text-sm font-medium text-gray-700">创建人</label>
                                <input type="text" placeholder="输入创建人账号" class="border rounded-lg px-3 py-2 w-full mt-1">
                            </div>
                            <div class="lg:col-span-2">
                                <label class="text-sm font-medium text-gray-700">创建时间</label>
                                <div class="flex items-center mt-1">
                                    <input type="date" class="border rounded-lg px-3 py-2 w-full">
                                    <span class="mx-2 text-gray-500">-</span>
                                    <input type="date" class="border rounded-lg px-3 py-2 w-full">
                                </div>
                            </div>
                            <div class="col-span-full flex justify-end space-x-2 mt-2">
                                 <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button>
                                 <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table id="template-table" class="custom-table w-full"><thead><tr><th>模板名称</th><th>创建人</th><th>模板内容(预览)</th><th>创建时间</th><th>最后修改时间</th><th>操作</th></tr></thead><tbody><tr><td class="template-name font-medium text-gray-800">标准委托服务协议 V3</td><td class="template-creator">admin</td><td class="template-content-preview" title="甲方 {{客户姓名}} (身份证号: {{客户身份证}}) 委托乙方进行数字资产管理..."><span class="hidden template-full-content"><h3>委托服务协议</h3><p>甲方：<strong>{{客户姓名}}</strong> (身份证号: {{客户身份证}})</p><p>乙方：币联CoinLink平台</p><p>...</p><p>委托金额为 <strong>{{委托金额}} USDT</strong>，分红比例为 <strong>{{分红比例}}</strong>。</p><p>委托周期：{{委托周期}}</p></span>甲方 {{客户姓名}} (身份证号: {{客户身份证}}) 委托乙方进行数字资产管理...</td><td>2023-01-15</td><td>2023-09-15</td><td class="space-x-4"><button onclick="openTemplateEditor(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-blue-600 hover:underline">预览</button><button class="text-red-600 hover:underline">删除</button></td></tr><tr><td class="template-name font-medium text-gray-800">高风险策略协议 V1</td><td class="template-creator">risk_manager</td><td class="template-content-preview" title="本协议适用于高风险偏好的客户 {{客户姓名}}，您确认已知晓相关风险..."><span class="hidden template-full-content"><h3>高风险策略服务协议</h3><p>客户：<strong>{{客户姓名}}</strong></p><p>...</p><p>委托周期：{{委托周期}}</p><p><em>请注意，高风险策略可能导致本金亏损。</em></p></span>本协议适用于高风险偏好的客户 {{客户姓名}}，您确认已知晓相关风险...</td><td>2023-05-20</td><td>2023-08-01</td><td class="space-x-4"><button onclick="openTemplateEditor(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-blue-600 hover:underline">预览</button><button class="text-red-600 hover:underline">删除</button></td></tr></tbody></table></div>
                </div>
                <div id="settle-overview" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">平台收益总览</h1>
                    <div class="mt-6 flex items-center justify-between bg-white p-4 rounded-xl shadow-md"><div class="flex items-center space-x-2"><label class="font-medium">选择周期:</label><input type="month" value="2023-10" class="border rounded-lg px-4 py-2"></div><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 flex items-center"><i data-lucide="download" class="mr-2 h-5 w-5"></i>导出财务报告</button></div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 mt-6"><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">总收入</p><p class="text-2xl font-bold text-green-600">$85k</p></div><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">总支出</p><p class="text-2xl font-bold text-red-600">$25k</p></div><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">净利润</p><p class="text-2xl font-bold text-gray-800">$60k</p></div><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">总流水(AUM)</p><p class="text-2xl font-bold text-gray-800">$1.28M</p></div><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">客户总盈利</p><p class="text-2xl font-bold text-gray-800">$284k</p></div><div class="bg-white p-4 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">付费客户数</p><p class="text-2xl font-bold text-gray-800">156</p></div></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6"><div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-lg font-semibold text-gray-700 mb-4">收支与利润趋势图</h2><div style="height: 300px;"><canvas id="profitTrendChart"></canvas></div></div><div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-lg font-semibold text-gray-700 mb-4">收入来源分析 (按操盘手)</h2><div style="height: 300px;"><canvas id="revenueSourceChart"></canvas></div></div></div>
                </div>
                <div id="settle-customer" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">客户收益结算</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4 items-end">
                            <div><label class="text-sm font-medium text-gray-700">结算周期</label><input type="month" value="2024-05" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">客户ID</label><input type="text" placeholder="输入客户ID" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">姓名</label><input type="text" placeholder="输入姓名" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">手机号</label><input type="text" placeholder="输入手机号" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">操盘手</label><select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部操盘手</option><option>稳健猎手</option><option>激进先锋</option></select></div>
                            <div><label class="text-sm font-medium text-gray-700">账单状态</label><select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部</option><option>待生成</option><option>待发送</option><option>待支付</option><option>待确认</option><option>已完成</option><option>本期亏损</option><option>已逾期</option></select></div>
                            <div class="col-span-full flex justify-end space-x-2 mt-2"><button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button></div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>合同编号</th><th>客户姓名</th><th>手机号码</th><th>操盘手</th><th>公司</th><th>结算周期</th><th>期初资金</th><th>期末资金</th><th>本期总收益</th><th>客户收益 (70%)</th><th>平台收益 (30%)</th><th>账单状态</th><th>更新时间</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr><td>CON-2024-05-101</td><td>李明</td><td>138****8888</td><td>激进先锋</td><td>-</td><td>2024/05/01-2024/05/31</td><td>50,000.00</td><td>51,500.00</td><td class="text-green-600 font-semibold">+1,500.00</td><td class="text-green-600">1,050.00</td><td>450.00</td><td><span class="badge badge-yellow">待确认</span></td><td>2024-06-02 10:30</td><td class="space-x-2"><button onclick="openVerificationModal()" class="text-purple-600 hover:underline font-semibold">核销支付</button><button onclick="openBillDetailModal()" class="text-blue-600 hover:underline">查看详情</button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settle-trader" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">操盘手收益结算</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end">
                            <div><label class="text-sm font-medium text-gray-700">结算周期</label><input type="month" value="2024-05" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">操盘手ID</label><input type="text" placeholder="输入ID" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">姓名</label><input type="text" placeholder="输入姓名" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">昵称</label><input type="text" placeholder="输入昵称" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">手机号</label><input type="text" placeholder="输入手机号" class="border rounded-lg px-3 py-2 w-full mt-1"></div>
                            <div><label class="text-sm font-medium text-gray-700">操盘手</label><select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部操盘手</option><option>稳健猎手</option><option>激进先锋</option></select></div>
                            <div><label class="text-sm font-medium text-gray-700">支付状态</label><select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部</option><option>待计算</option><option>待支付</option><option>已支付</option><option>暂不支付</option></select></div>
                            <div class="col-span-full flex justify-end space-x-2 mt-2"><button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button></div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>合同编号</th><th>ID</th><th>姓名</th><th>昵称</th><th>公司</th><th>结算周期</th><th>期初资金</th><th>期末资金</th><th>本期总收益</th><th>操盘手收益 (20%)</th><th>账单状态</th><th>支付状态</th><th>审批人</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr><td>BILL-T-05-002</td><td>T02</td><td>李娜</td><td>激进先锋</td><td>阿尔法资本</td><td>2024/05/01-2024/05/31</td><td>410,000</td><td>435,000</td><td class="text-green-600 font-semibold">+25,000</td><td class="text-green-600 font-semibold">5,000</td><td><span class="badge badge-green">已生成</span></td><td><span class="badge badge-blue">待支付</span></td><td>admin_manager</td><td class="space-x-2"><button onclick="openInitiatePaymentModal()" class="text-purple-600 hover:underline font-semibold">发起支付</button><button onclick="openTraderBillDetailModal()" class="text-blue-600 hover:underline">查看详情</button></td></tr>
                                <tr><td>BILL-T-05-001</td><td>T01</td><td>张伟</td><td>稳健猎手</td><td>-</td><td>2024/05/01-2024/05/31</td><td>570,000</td><td>582,000</td><td class="text-green-600 font-semibold">+12,000</td><td class="text-green-600 font-semibold">2,400</td><td><span class="badge badge-green">已生成</span></td><td><span class="badge badge-green">已支付</span></td><td>admin_manager</td><td class="space-x-2"><button onclick="openTraderBillDetailModal()" class="text-blue-600 hover:underline">查看详情</button></td></tr>
                                 <tr><td>BILL-T-05-003</td><td>T03</td><td>王强</td><td>趋势之王</td><td>-</td><td>2024/05/01-2024/05/31</td><td>300,000</td><td>295,000</td><td class="text-red-600 font-semibold">-5,000</td><td class="text-red-600">0</td><td><span class="badge badge-gray">本期亏损</span></td><td><span class="badge badge-gray">暂不支付</span></td><td>系统</td><td class="space-x-2"><button onclick="openTraderBillDetailModal()" class="text-blue-600 hover:underline">查看详情</button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settings-accounts" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">账号管理</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
                            <input type="text" placeholder="姓名" class="border rounded-lg px-3 py-2 w-full">
                            <input type="text" placeholder="手机号码" class="border rounded-lg px-3 py-2 w-full">
                            <input type="text" placeholder="账号" class="border rounded-lg px-3 py-2 w-full">
                            <select class="border rounded-lg px-3 py-2 w-full"><option>所有角色</option><option>超级管理员</option><option>运营人员</option><option>操盘手</option></select>
                            <select class="border rounded-lg px-3 py-2 w-full"><option>所有状态</option><option>启用</option><option>未启用</option></select>
                        </div>
                        <div class="mt-4 flex justify-between items-center">
                            <button onclick="openAccountModal(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="h-5 w-5 mr-2"></i>新增账号</button>
                            <div class="space-x-2">
                                <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button>
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>账号</th><th>姓名</th><th>手机号码</th><th>公司</th><th>角色</th><th>状态</th><th>最近修改人</th><th>创建时间</th><th>最近修改时间</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr><td>superadmin</td><td>陈浩</td><td>13800138000</td><td>-</td><td>超级管理员</td><td><span class="badge badge-green">启用</span></td><td>-</td><td>2023-01-01 10:00</td><td>-</td><td class="space-x-4"><button onclick="openAccountModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">重置密码</button></td></tr>
                                <tr><td>operator_li</td><td>李静</td><td>13912345678</td><td>-</td><td>运营人员</td><td><span class="badge badge-green">启用</span></td><td>superadmin</td><td>2023-02-15 14:30</td><td>2024-05-10 09:00</td><td class="space-x-4"><button onclick="openAccountModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">重置密码</button></td></tr>
                                <tr><td>trader_zhang</td><td>张伟</td><td>13811112222</td><td>-</td><td>操盘手</td><td><span class="badge badge-gray">未启用</span></td><td>superadmin</td><td>2023-03-20 11:00</td><td>2024-01-20 16:00</td><td class="space-x-4"><button onclick="openAccountModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">重置密码</button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settings-roles-mgmt" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">角色管理</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                         <div class="flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <input type="text" placeholder="角色名称" class="border rounded-lg px-3 py-2 w-64">
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                            <button onclick="openRoleModal('add')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="h-5 w-5 mr-2"></i>新增角色</button>
                        </div>
                    </div>
                     <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>角色名称</th><th>描述</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr><td class="font-medium">超级管理员</td><td>拥有系统所有权限，负责系统的维护与管理。</td><td class="space-x-4"><button onclick="openRoleModal('view', this)" class="text-blue-600 hover:underline">详情</button><button onclick="openRoleModal('edit', this)" class="text-indigo-600 hover:underline">编辑</button></td></tr>
                                <tr><td class="font-medium">运营人员</td><td>负责日常运营，如客户管理、合同审核、结算处理等。</td><td class="space-x-4"><button onclick="openRoleModal('view', this)" class="text-blue-600 hover:underline">详情</button><button onclick="openRoleModal('edit', this)" class="text-indigo-600 hover:underline">编辑</button></td></tr>
                                <tr><td class="font-medium">操盘手</td><td>仅可访问客户管理、合同管理等与其业务相关的模块。</td><td class="space-x-4"><button onclick="openRoleModal('view', this)" class="text-blue-600 hover:underline">详情</button><button onclick="openRoleModal('edit', this)" class="text-indigo-600 hover:underline">编辑</button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settings-sms-channels" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">短信渠道配置</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                         <div class="flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <input type="text" placeholder="渠道名称" class="border rounded-lg px-3 py-2 w-64">
                                <select class="border rounded-lg px-3 py-2 w-48"><option>全部状态</option><option>启用</option><option>关闭</option></select>
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                            <button onclick="openSmsChannelModal(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="h-5 w-5 mr-2"></i>新增短信渠道</button>
                        </div>
                    </div>
                     <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>渠道类型</th><th>渠道名称</th><th>AccessKey</th><th>AccessSecret</th><th>SenderID</th><th>状态</th><th>修改人</th><th>修改时间</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge badge-blue">验证码短信渠道</span></td>
                                    <td class="font-medium">阿里云短信</td>
                                    <td>LTAI5t...fG7y</td>
                                    <td><div class="table-description" title="Ps8k...oP1z">**********</div></td>
                                    <td>CoinLink</td>
                                    <td><span class="badge badge-green">启用</span></td>
                                    <td>superadmin</td>
                                    <td>2024-05-20 11:30:15</td>
                                    <td class="space-x-4"><button onclick="openSmsChannelModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">删除</button></td>
                                </tr>
                                <tr>
                                    <td><span class="badge badge-purple">通知类短信渠道</span></td>
                                    <td class="font-medium">Twilio</td>
                                    <td>AC...3a2f</td>
                                    <td><div class="table-description" title="Auth...Token">**********</div></td>
                                    <td>+15017122661</td>
                                    <td><span class="badge badge-gray">关闭</span></td>
                                    <td>operator_li</td>
                                    <td>2024-03-11 09:00:00</td>
                                    <td class="space-x-4"><button onclick="openSmsChannelModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">删除</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settings-sms-app" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">APP短信配置</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                         <div class="flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <input type="text" placeholder="短信名称" class="border rounded-lg px-3 py-2 w-64">
                                <select class="border rounded-lg px-3 py-2 w-48"><option>全部状态</option><option>开启</option><option>关闭</option></select>
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                            <button onclick="openAppSmsModal(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="h-5 w-5 mr-2"></i>新增短信配置</button>
                        </div>
                    </div>
                     <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead><tr><th>短信名称</th><th>渠道类型</th><th>发送方式</th><th>模板内容</th><th>状态</th><th>修改人</th><th>修改时间</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td class="font-medium">注册登录</td>
                                    <td><span class="badge badge-blue">验证码短信渠道</span></td>
                                    <td>触发发送</td>
                                    <td class="table-content" title="【币联】您的验证码是{code}，5分钟内有效，请勿泄露。">【币联】您的验证码是{code}，5分钟内有效，请勿泄露。</td>
                                    <td><span class="badge badge-green">开启</span></td>
                                    <td>superadmin</td>
                                    <td>2024-05-18 10:00:00</td>
                                    <td class="space-x-4"><button onclick="openAppSmsModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">删除</button></td>
                                </tr>
                                <tr>
                                    <td class="font-medium">结算通知</td>
                                    <td><span class="badge badge-purple">通知类短信渠道</span></td>
                                    <td>定时发送</td>
                                    <td class="table-content" title="【币联】尊敬的{username}，您{month}月的收益结算账单已生成，请登录APP查看详情。">【币联】尊敬的{username}，您{month}月的收益结算账单已生成...</td>
                                    <td><span class="badge badge-green">开启</span></td>
                                    <td>operator_li</td>
                                    <td>2024-05-19 14:20:00</td>
                                    <td class="space-x-4"><button onclick="openAppSmsModal(true, this)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">删除</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="settings-content" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">消息管理</h1>
                    <div class="border-b border-gray-200 mt-6">
                        <nav class="flex space-x-4" aria-label="Tabs">
                            <button id="tab-btn-announcement" onclick="switchContentTab('announcement')" class="tab-button active">公告管理</button>
                            <button id="tab-btn-push" onclick="switchContentTab('push')" class="tab-button">推送消息</button>
                        </nav>
                    </div>

                    <div id="tab-pane-announcement" class="tab-pane active mt-6">
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <input type="text" placeholder="公告标题" class="border rounded-lg px-3 py-2 w-52">
                                    <select class="border rounded-lg px-3 py-2 w-40"><option>所有类型</option><option>平台公告</option><option>活动通知</option><option>系统维护</option></select>
                                    <select class="border rounded-lg px-3 py-2 w-40"><option>所有状态</option><option>已发布</option><option>待发布</option><option>已下线</option><option>草稿</option></select>
                                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                                </div>
                                <button onclick="openAnnouncementModal(false)" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center"><i data-lucide="plus" class="h-5 w-5 mr-2"></i>发布新公告</button>
                            </div>
                        </div>
                        <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                            <table class="custom-table w-full">
                                <thead><tr><th>ID</th><th>公告标题</th><th>类型</th><th>状态</th><th>排序</th><th>发布时间</th><th>创建人</th><th>操作</th></tr></thead>
                                <tbody>
                                    <tr>
                                        <td>101</td><td class="font-medium">关于2024年端午节休假安排的通知</td><td><span class="badge badge-purple">平台公告</span></td><td><span class="badge badge-green">已发布</span></td><td>10</td><td>2024-06-05 10:00</td><td>运营A</td><td class="space-x-4"><button onclick="openAnnouncementModal(true)" class="text-indigo-600 hover:underline">编辑</button><button class="text-red-600 hover:underline">下线</button></td>
                                    </tr>
                                    <tr>
                                        <td>100</td><td class="font-medium">系统将于6月10日凌晨2-4点进行升级维护</td><td><span class="badge badge-orange">系统维护</span></td><td><span class="badge badge-yellow">待发布</span></td><td>99</td><td>2024-06-09 18:00</td><td>技术部</td><td class="space-x-4"><button onclick="openAnnouncementModal(true)" class="text-indigo-600 hover:underline">编辑</button><button class="text-blue-600 hover:underline">发布</button></td>
                                    </tr>
                                    <tr>
                                        <td>99</td><td class="font-medium">五月交易大赛圆满结束，获奖名单公示</td><td><span class="badge badge-cyan">活动通知</span></td><td><span class="badge badge-gray">已下线</span></td><td>5</td><td>2024-06-01 12:00</td><td>运营B</td><td class="space-x-4"><button onclick="openAnnouncementModal(true)" class="text-indigo-600 hover:underline">编辑</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="tab-pane-push" class="tab-pane mt-6">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 border-b pb-4">创建新的推送</h3>
                                <form class="space-y-4">
                                    <div><label class="font-medium text-sm">推送标题</label><input type="text" placeholder="20字以内" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                                    <div><label class="font-medium text-sm">推送内容</label><textarea rows="3" placeholder="40字以内" class="border rounded-lg px-4 py-2 w-full mt-1"></textarea></div>
                                    <div><label class="font-medium text-sm">落地页链接 (选填)</label><input type="url" placeholder="https://..." class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                                    <div>
                                        <label class="font-medium text-sm">目标用户</label>
                                        <div class="flex items-center space-x-6 mt-2">
                                            <label class="flex items-center"><input type="radio" name="pushTarget" value="all" checked class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">全部用户</span></label>
                                            <label class="flex items-center"><input type="radio" name="pushTarget" value="specific" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">特定用户</span></label>
                                        </div>
                                        <div id="specific-user-group" class="mt-2 hidden"><select multiple class="border rounded-lg px-4 py-2 w-full"><option>所有操盘手</option><option>所有客户</option><option>近30日有交易用户</option><option>高净值用户(AUM > 10万)</option></select></div>
                                    </div>
                                     <div>
                                        <label class="font-medium text-sm">发送时间</label>
                                        <div class="flex items-center space-x-6 mt-2">
                                            <label class="flex items-center"><input type="radio" name="pushTime" value="now" checked class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">立即发送</span></label>
                                            <label class="flex items-center"><input type="radio" name="pushTime" value="scheduled" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">定时发送</span></label>
                                        </div>
                                        <div id="scheduled-time-group" class="mt-2 hidden"><input type="datetime-local" class="border rounded-lg px-4 py-2 w-full"></div>
                                    </div>
                                    <div class="pt-4"><button type="button" class="w-full bg-indigo-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-indigo-700">发送推送</button></div>
                                </form>
                            </div>
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                                 <h3 class="text-xl font-bold text-gray-800 mb-6 border-b pb-4">历史推送记录</h3>
                                 <div class="overflow-x-auto">
                                    <table class="custom-table w-full">
                                        <thead><tr><th>发送时间</th><th>标题</th><th>内容</th><th>目标用户</th><th>状态</th><th>操作人</th></tr></thead>
                                        <tbody>
                                            <tr><td>2024-06-03 18:00</td><td class="font-medium">新功能上线！</td><td class="push-content-preview">策略广场功能已上线，快来发现顶尖操盘手！</td><td>全部用户</td><td><span class="badge badge-green">已发送</span></td><td>运营A</td></tr>
                                            <tr><td>2024-05-20 10:00</td><td class="font-medium">邀请好友，同享收益</td><td class="push-content-preview">邀请好友加入币联，您可获得丰厚返佣奖励。</td><td>近30日有交易用户</td><td><span class="badge badge-green">已发送</span></td><td>运营B</td></tr>
                                        </tbody>
                                    </table>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="settings-app" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">APP配置</h1>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="custom-table w-full">
                            <thead>
                                <tr><th>配置项</th><th>内容概要</th><th>修改人</th><th>修改时间</th><th>操作</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-medium">关于我们</td>
                                    <td class="table-content" title="币联是一个安全、透明、合规的资产增值服务平台，致力于为全球用户提供专业的数字资产管理方案。我们拥有顶尖的金融科技团队和严格的风控体系，确保客户资产安全与稳定增值。">币联是一个安全、透明、合规的资产增值服务平台....</td>
                                    <td>superadmin</td>
                                    <td>2024-01-10 10:00:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'about')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'about')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="font-medium">联系我们</td>
                                    <td class="table-content" title="客服电话: 400-800-8888, 客服邮箱: support@coinlink.com">客服电话: 400-800-8888, 客服邮箱: support@coinlink.com</td>
                                    <td>superadmin</td>
                                    <td>2024-01-10 10:05:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'contact')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'contact')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="font-medium">用户协议</td>
                                    <td class="table-content" title="<h1>第一条 总则</h1><p>1.1 本协议旨在明确用户在使用币联服务时的权利与义务...</p>">第一条 总则 1.1 本协议旨在明确用户在使用币联服务时...</td>
                                    <td>legal_dept</td>
                                    <td>2024-04-15 16:30:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'userAgreement')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'userAgreement')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="font-medium">隐私协议</td>
                                    <td class="table-content" title="<h1>引言</h1><p>我们非常重视您的个人信息和隐私保护...</p>">引言 我们非常重视您的个人信息和隐私保护...</td>
                                    <td>legal_dept</td>
                                    <td>2024-04-15 16:35:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'privacyPolicy')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'privacyPolicy')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                 <tr>
                                    <td class="font-medium">活体阈值</td>
                                    <td class="table-content" title="活体识别接口的调用通过率标准">通过率：75%</td>
                                    <td>risk_manager</td>
                                    <td>2024-03-01 11:00:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'liveness')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'liveness')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                 <tr>
                                    <td class="font-medium">1:1阈值</td>
                                    <td class="table-content" title="人脸1:1比对接口的调用通过率标准">通过率：75%</td>
                                    <td>risk_manager</td>
                                    <td>2024-03-01 11:05:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'one_to_one')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'one_to_one')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                 <tr>
                                    <td class="font-medium">OCR阈值</td>
                                    <td class="table-content" title="OCR识别接口的单用户每日调用次数限制">单用户每日调用次数：10次</td>
                                    <td>risk_manager</td>
                                    <td>2024-03-01 11:10:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'ocr')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'ocr')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="font-medium">电子签字配置</td>
                                    <td class="table-content" title="电子签名服务的单用户每日调用次数限制">单用户每日调用次数：10次</td>
                                    <td>risk_manager</td>
                                    <td>2024-03-01 11:15:00</td>
                                    <td class="space-x-4">
                                        <button onclick="openConfigModal('edit', 'esign')" class="text-indigo-600 hover:underline">编辑</button>
                                        <button onclick="openConfigModal('view', 'esign')" class="text-blue-600 hover:underline">查看</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="risk-monitor" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">异常交易监控</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-8 gap-4 items-end">
                            <div class="lg:col-span-3">
                                <label class="text-sm font-medium text-gray-700">警报时间</label>
                                <div class="flex items-center mt-1">
                                    <input type="datetime-local" class="border rounded-lg px-3 py-2 w-full">
                                    <span class="mx-2 text-gray-500">-</span>
                                    <input type="datetime-local" class="border rounded-lg px-3 py-2 w-full">
                                </div>
                            </div>
                            <div class="lg:col-span-1">
                                <label class="text-sm font-medium text-gray-700">涉及用户</label>
                                <input type="text" placeholder="用户ID" class="border rounded-lg px-3 py-2 w-full mt-1">
                            </div>
                            <div class="lg:col-span-1">
                                 <label class="text-sm font-medium text-gray-700">警报类型</label>
                                 <select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部</option><option>大额交易</option><option>高频操作</option></select>
                            </div>
                            <div class="lg:col-span-1">
                                 <label class="text-sm font-medium text-gray-700">风险等级</label>
                                 <select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部</option><option>高</option><option>中</option><option>低</option></select>
                            </div>
                            <div class="lg:col-span-1">
                                 <label class="text-sm font-medium text-gray-700">状态</label>
                                 <select class="border rounded-lg px-3 py-2 w-full mt-1"><option>全部</option><option>待处理</option><option>已处理</option></select>
                            </div>
                            <div class="lg:col-span-1 flex justify-start space-x-2">
                                 <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button>
                                 <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>警报ID</th><th>时间</th><th>警报类型</th><th>涉及用户</th><th>风险等级</th><th>状态</th><th>操作</th></tr></thead><tbody><tr class="bg-red-50"><td>ALERT-0987</td><td>2023-10-26 14:10</td><td>大额交易</td><td>1004</td><td><span class="badge badge-red">高</span></td><td><span class="badge badge-yellow">待处理</span></td><td><a href="#" class="text-indigo-600 font-semibold hover:underline">查看并处理</a></td></tr></tbody></table></div>
                </div>
                <div id="risk-api" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">API Key监控</h1>
                    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                         <div class="flex flex-wrap justify-between items-center gap-4">
                            <div class="flex items-center gap-4">
                                <input type="text" placeholder="客户ID" class="border rounded-lg px-3 py-2 w-52">
                                <select class="border rounded-lg px-3 py-2 w-48"><option>全部交易所</option><option>Binance</option><option>OKX</option></select>
                                <select class="border rounded-lg px-3 py-2 w-64"><option>提现权限状态</option><option>已开启 (高风险!)</option><option>未开启</option></select>
                            </div>
                            <div class="flex items-center gap-2">
                                <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button>
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>客户ID</th><th>交易所</th><th>API Key</th><th>交易权限</th><th>提现权限状态</th></tr></thead><tbody><tr class="bg-red-100 text-red-800 font-bold"><td>1024</td><td>Binance</td><td>mno...pqr</td><td><span class="badge badge-green">已开启</span></td><td><span class="badge badge-red">已开启 (高风险!)</span></td></tr><tr><td>1001</td><td>Binance</td><td>bkC...4qE</td><td><span class="badge badge-green">已开启</span></td><td><span class="badge badge-green">未开启</span></td></tr></tbody></table></div>
                </div>
                <div id="risk-logs" class="page">
                    <h1 class="text-2xl font-bold text-gray-800">操作日志</h1>
                     <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
                        <div class="grid grid-cols-1 lg:grid-cols-7 gap-4 items-end">
                            <div class="lg:col-span-3">
                                <label class="text-sm font-medium text-gray-700">时间</label>
                                <div class="flex items-center mt-1">
                                    <input type="datetime-local" class="border rounded-lg px-3 py-2 w-full">
                                    <span class="mx-2 text-gray-500">-</span>
                                    <input type="datetime-local" class="border rounded-lg px-3 py-2 w-full">
                                </div>
                            </div>
                            <div class="lg:col-span-1">
                                <label class="text-sm font-medium text-gray-700">操作人</label>
                                <input type="text" placeholder="输入账号" class="border rounded-lg px-3 py-2 w-full mt-1">
                            </div>
                            <div class="lg:col-span-1">
                                <label class="text-sm font-medium text-gray-700">操作模块</label>
                                <input type="text" placeholder="输入模块" class="border rounded-lg px-3 py-2 w-full mt-1">
                            </div>
                            <div class="lg:col-span-2 flex justify-start space-x-2">
                                 <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">重置</button>
                                 <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">搜索</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-white rounded-xl shadow-md overflow-x-auto"><table class="custom-table w-full"><thead><tr><th>时间戳</th><th>操作人</th><th>IP地址</th><th>操作模块</th><th>操作行为</th><th>详细信息</th></tr></thead><tbody><tr><td>2023-10-26 15:00:12</td><td>admin_01</td><td>127.0.0.1</td><td>客户管理</td><td>编辑</td><td>将客户#1002状态从[待审核]修改为[生效中]</td></tr></tbody></table></div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- All Modals (Verified) -->
    <div id="addTraderModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="traderModalTitle" class="text-2xl font-bold text-gray-800 mb-6">新增操盘手</h2>
            <form id="traderModalForm" class="space-y-4">
                <div><label class="font-medium text-sm">姓名</label><input type="text" name="name" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">手机号码</label><input type="text" name="phone" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">公司名称 (如有)</label><input type="text" name="company" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">操盘手昵称</label><input type="text" name="nickname" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">交易风格</label><select name="style" class="border rounded-lg px-4 py-2 w-full mt-1"><option>稳健型</option><option>平衡型</option><option>激进型</option></select></div>
                <div><label class="font-medium text-sm">交易经验 (年)</label><input type="number" name="experience" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">起投资金 (USDT)</label><input type="number" name="min_investment" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">简介 (策略/个人简介)</label><textarea name="bio" rows="3" class="border rounded-lg px-4 py-2 w-full mt-1"></textarea></div>
            </form>
            <div class="flex justify-end mt-8">
                <button onclick="hideModal('addTraderModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg mr-2 font-semibold hover:bg-gray-400">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">保存</button>
            </div>
        </div>
    </div>
    <div id="templateEditorModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl h-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b"><h2 id="templateEditorTitle" class="text-2xl font-bold text-gray-800">创建新模板</h2><button onclick="hideModal('templateEditorModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <div class="flex-grow p-4 grid grid-cols-1 md:grid-cols-4 gap-6 modal-content-area">
                <div class="md:col-span-3 flex flex-col"><div><label for="templateNameInput" class="font-medium text-sm text-gray-700">模板名称</label><input type="text" id="templateNameInput" placeholder="例如：标准委托服务协议 V4" class="border rounded-lg px-4 py-2 w-full mt-1 mb-4"></div><div class="flex-grow flex flex-col"><label class="font-medium text-sm text-gray-700 mb-1">模板内容</label><div id="editor-container" class="bg-white border rounded-lg flex-grow"></div></div></div>
                <div class="md:col-span-1 bg-gray-50 p-4 rounded-lg border h-full"><h3 class="font-semibold text-gray-800 mb-4">可用变量</h3><p class="text-xs text-gray-500 mb-4">点击下方变量，可将其插入到编辑器光标位置。</p><div id="variable-tags-container" class="space-y-2"><span class="variable-tag block">{{客户姓名}}</span><span class="variable-tag block">{{客户身份证}}</span><span class="variable-tag block">{{委托金额}}</span><span class="variable-tag block">{{分红比例}}</span><span class="variable-tag block">{{委托周期}}</span><span class="variable-tag block">{{操盘手昵称}}</span><span class="variable-tag block">{{合同编号}}</span><span class="variable-tag block">{{当前日期}}</span></div></div>
            </div>
            <div class="flex justify-end p-4 border-t bg-gray-50"><button onclick="hideModal('templateEditorModal')" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg mr-2 font-semibold hover:bg-gray-300">取消</button><button class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700">保存模板</button></div>
        </div>
    </div>
    <div id="billDetailModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-7xl">
            <div class="flex justify-between items-center border-b pb-3 mb-6"><h2 class="text-xl font-bold text-gray-800">账单详情</h2><button onclick="hideModal('billDetailModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <table class="detail-table mb-6">
                <tbody>
                    <tr><td class="label">合同编号</td><td class="value">CON-2024-05-101</td><td class="label">账单编号</td><td class="value">BILL-05-101-2024</td></tr>
                    <tr><td class="label">结算周期</td><td class="value">2024-05-01 至 2024-05-31</td><td class="label">账单金额</td><td class="value font-bold text-indigo-600">450.00 USDT</td></tr>
                    <tr><td class="label">支付方式</td><td class="value">TRC20-USDT</td><td class="label">支付状态</td><td class="value"><span class="badge badge-yellow">待确认</span></td></tr>
                    <tr><td class="label">支付时间</td><td class="value">2024-06-02 10:25</td><td class="label">是否开票</td><td class="value">否</td></tr>
                    <tr><td class="label">收款账户</td><td class="value" colspan="3"><select class="border rounded-lg px-3 py-1.5 w-full"><option>TRC20: T...xyz (默认)</option><option>ERC20: 0x...abc</option></select></td></tr>
                </tbody>
            </table>
            <div class="overflow-x-auto"><table class="w-full text-sm">
                    <thead class="bg-blue-600 text-white"><tr><th class="p-3 text-left font-semibold">客户姓名</th><th class="p-3 text-left font-semibold">客户手机号码</th><th class="p-3 text-left font-semibold">账单金额</th><th class="p-3 text-left font-semibold">结算周期</th><th class="p-3 text-left font-semibold">期初资金</th><th class="p-3 text-left font-semibold">期末资金</th><th class="p-3 text-left font-semibold">本期总收益</th><th class="p-3 text-left font-semibold">客户收益</th><th class="p-3 text-left font-semibold">平台收益</th><th class="p-3 text-left font-semibold">备注</th></tr></thead>
                    <tbody><tr class="bg-gray-50 border-b"><td class="p-3">李明</td><td class="p-3">138****8888</td><td class="p-3">450.00</td><td class="p-3">2024/05/01-2024/05/31</td><td class="p-3">50,000.00</td><td class="p-3">51,500.00</td><td class="p-3 text-green-600 font-semibold">+1,500.00</td><td class="p-3">1,050.00</td><td class="p-3">450.00</td><td class="p-3">分红</td></tr></tbody>
                </table></div>
            <div class="flex justify-end mt-6 space-x-3"><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">发送账单</button><button onclick="hideModal('billDetailModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">返回</button></div>
        </div>
    </div>
    <div id="verificationModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-7xl">
            <div class="flex justify-between items-center border-b pb-3 mb-6"><h2 class="text-xl font-bold text-gray-800">核销详情</h2><button onclick="hideModal('verificationModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
             <table class="detail-table mb-6">
                <tbody>
                    <tr><td class="label">合同编号</td><td class="value">CON-2024-05-101</td><td class="label">账单编号</td><td class="value">BILL-05-101-2024</td></tr>
                    <tr><td class="label">结算周期</td><td class="value">2024-05-01 至 2024-05-31</td><td class="label">账单金额</td><td class="value font-bold text-indigo-600">450.00 USDT</td></tr>
                    <tr><td class="label">支付方式</td><td class="value">TRC20-USDT</td><td class="label">支付状态</td><td class="value"><span class="badge badge-yellow">待确认</span></td></tr>
                    <tr><td class="label">支付时间</td><td class="value">2024-06-02 10:25</td><td class="label">是否开票</td><td class="value">否</td></tr>
                    <tr><td class="label">收款账户</td><td class="value" colspan="3">TRC20: T...xyz (默认)</td></tr>
                </tbody>
            </table>
            <div class="mb-6"><label class="font-medium text-gray-700 text-sm">支付凭证</label><div class="mt-1 p-3 border rounded-lg bg-gray-50"><a href="#" target="_blank" class="text-indigo-600 underline hover:text-indigo-800 font-semibold">0xabc...def123 (点击查看交易详情)</a></div></div>
            <div class="overflow-x-auto"><table class="w-full text-sm">
                    <thead class="bg-blue-600 text-white"><tr><th class="p-3 text-left font-semibold">客户姓名</th><th class="p-3 text-left font-semibold">客户手机号码</th><th class="p-3 text-left font-semibold">账单金额</th><th class="p-3 text-left font-semibold">结算周期</th><th class="p-3 text-left font-semibold">期初资金</th><th class="p-3 text-left font-semibold">期末资金</th><th class="p-3 text-left font-semibold">本期总收益</th><th class="p-3 text-left font-semibold">客户收益</th><th class="p-3 text-left font-semibold">平台收益</th><th class="p-3 text-left font-semibold">备注</th></tr></thead>
                    <tbody><tr class="bg-gray-50 border-b"><td class="p-3">李明</td><td class="p-3">138****8888</td><td class="p-3">450.00</td><td class="p-3">2024/05/01-2024/05/31</td><td class="p-3">50,000.00</td><td class="p-3">51,500.00</td><td class="p-3 text-green-600 font-semibold">+1,500.00</td><td class="p-3">1,050.00</td><td class="p-3">450.00</td><td class="p-3">分红</td></tr></tbody>
                </table></div>
            <div class="flex justify-between items-center mt-6"><input type="text" placeholder="可在此添加备注信息..." class="border rounded-lg px-3 py-2 w-1/2"><div class="space-x-3"><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700">确认收款</button><button onclick="hideModal('verificationModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">返回</button></div></div>
        </div>
    </div>
    <div id="traderBillDetailModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-7xl">
            <div class="flex justify-between items-center border-b pb-3 mb-6"><h2 class="text-xl font-bold text-gray-800">操盘手账单详情</h2><button onclick="hideModal('traderBillDetailModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <dl class="trader-detail-grid mb-6">
                <dt>合同编号:</dt><dd>BILL-T-05-002</dd><dt>操盘手:</dt><dd>李娜 (激进先锋)</dd><dt>操盘手ID:</dt><dd>T02</dd><dt>结算周期:</dt><dd>2024-05-01 至 2024-05-31</dd>
                <dt>期初总资金:</dt><dd>410,000.00</dd><dt>期末总资金:</dt><dd>435,000.00</dd><dt>本期总收益:</dt><dd class="text-green-600 font-semibold">+25,000.00</dd><dt>应付操盘手收益:</dt><dd class="text-green-600 font-bold text-lg">5,000.00 USDT</dd>
                <dt>账单状态:</dt><dd><span class="badge badge-green">已生成</span></dd><dt>支付状态:</dt><dd><span class="badge badge-blue">待支付</span></dd><dt>审批人:</dt><dd>admin_manager</dd><dt>更新时间:</dt><dd>2024-06-03 11:00</dd>
            </dl>
            <h3 class="text-lg font-semibold text-gray-700 mb-3 mt-6 border-t pt-4">管理客户收益贡献列表</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-100"><tr><th class="p-3 text-left font-semibold">客户姓名</th><th class="p-3 text-left font-semibold">期初资金</th><th class="p-3 text-left font-semibold">本期收益</th><th class="p-3 text-left font-semibold">平台总收益(30%)</th></tr></thead>
                    <tbody>
                        <tr class="border-b"><td class="p-3">李明</td><td class="p-3">50,000.00</td><td class="p-3 text-green-600">+1,500.00</td><td class="p-3">450.00</td></tr>
                        <tr class="border-b"><td class="p-3">赵强</td><td class="p-3">100,000.00</td><td class="p-3 text-green-600">+8,000.00</td><td class="p-3">2,400.00</td></tr>
                        <tr class="border-b"><td class="p-3">周杰</td><td class="p-3">260,000.00</td><td class="p-3 text-green-600">+15,500.00</td><td class="p-3">4,650.00</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end mt-6 space-x-3"><button onclick="hideModal('traderBillDetailModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">返回</button></div>
        </div>
    </div>
    <div id="initiatePaymentModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl">
            <div class="flex justify-between items-center border-b pb-3 mb-6"><h2 class="text-xl font-bold text-gray-800">发起支付确认</h2><button onclick="hideModal('initiatePaymentModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <div class="space-y-4">
                <div class="flex items-baseline"><label class="font-medium text-gray-700 w-32 text-right mr-4">支付对象:</label><span class="font-semibold text-gray-800">李娜 (激进先锋)</span></div>
                <div class="flex items-baseline"><label class="font-medium text-gray-700 w-32 text-right mr-4">支付金额:</label><span class="font-bold text-2xl text-green-600">5,000.00 USDT</span></div>
                <div><label for="paymentHash" class="block font-medium text-gray-700 mb-1">支付交易哈希 (TxID)</label><input type="text" id="paymentHash" class="border rounded-lg px-3 py-2 w-full" placeholder="请输入链上交易哈希/ID"></div>
                <div><label for="paymentNotes" class="block font-medium text-gray-700 mb-1">支付备注</label><textarea id="paymentNotes" rows="3" class="border rounded-lg px-3 py-2 w-full" placeholder="选填，可输入内部备注信息"></textarea></div>
            </div>
            <div class="flex justify-end mt-6 space-x-3"><button onclick="hideModal('initiatePaymentModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">取消</button><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700">确认已支付</button></div>
        </div>
    </div>
    <div id="accountModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="accountModalTitle" class="text-2xl font-bold text-gray-800 mb-6">新增账号</h2>
            <form id="accountModalForm" class="space-y-4">
                <div><label class="font-medium text-sm">账号</label><input type="text" name="account" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">密码</label><input type="password" name="password" placeholder="留空则不修改" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">姓名</label><input type="text" name="name" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">手机号码</label><input type="text" name="phone" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">公司</label><input type="text" name="company" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">角色</label><select name="role" class="border rounded-lg px-4 py-2 w-full mt-1"><option>超级管理员</option><option>运营人员</option><option>操盘手</option></select></div>
                <div class="flex items-center"><label class="font-medium text-sm mr-4">状态</label><label class="switch"><input type="checkbox" name="status" checked><span class="slider"></span></label><span class="ml-2 text-gray-600">启用</span></div>
            </form>
            <div class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('accountModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="roleModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-4xl max-h-[90vh] flex flex-col">
            <h2 id="roleModalTitle" class="text-2xl font-bold text-gray-800 mb-6 flex-shrink-0">新增角色</h2>
            <div class="flex-grow modal-content-area pr-2">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-full">
                    <div class="md:col-span-1 space-y-4">
                        <div><label class="font-medium text-sm">角色名称</label><input type="text" id="roleNameInput" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                        <div><label class="font-medium text-sm">描述</label><textarea id="roleDescInput" rows="4" class="border rounded-lg px-4 py-2 w-full mt-1"></textarea></div>
                    </div>
                    <div class="md:col-span-2 border-l pl-6">
                        <h3 class="font-semibold text-lg mb-2">权限选择</h3>
                        <div id="permissionTreeContainer" class="permission-tree"></div>
                    </div>
                </div>
            </div>
            <div class="flex justify-end mt-8 space-x-3 flex-shrink-0 pt-4 border-t">
                <button onclick="hideModal('roleModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button id="roleModalConfirmBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="smsChannelModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="smsChannelModalTitle" class="text-2xl font-bold text-gray-800 mb-6">新增短信渠道</h2>
            <form id="smsChannelModalForm" class="space-y-4">
                <div><label class="font-medium text-sm">渠道类型</label><select name="channelType" class="border rounded-lg px-4 py-2 w-full mt-1"><option disabled selected>请选择</option><option>验证码短信渠道</option><option>通知类短信渠道</option></select></div>
                <div><label class="font-medium text-sm">渠道名称</label><input type="text" name="channelName" placeholder="请输入" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">AccessKey</label><input type="text" name="accessKey" placeholder="请输入" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">AccessSecret</label><input type="password" name="accessSecret" placeholder="请输入" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label class="font-medium text-sm">SenderID</label><input type="text" name="senderId" placeholder="请输入" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div class="flex items-center pt-2"><label class="font-medium text-sm mr-4">状态</label><label class="switch"><input type="checkbox" name="status" checked><span class="slider"></span></label><span class="ml-2 text-gray-600">开启</span></div>
            </form>
            <div class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('smsChannelModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="appSmsModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="appSmsModalTitle" class="text-2xl font-bold text-gray-800 mb-6">新增短信配置</h2>
            <form id="appSmsModalForm" class="space-y-4">
                <div><label class="font-medium text-sm">短信名称</label><select name="smsName" class="border rounded-lg px-4 py-2 w-full mt-1"><option disabled selected>请选择</option><option>注册登录</option><option>找回密码</option><option>结算通知</option><option>风控告警</option></select></div>
                <div><label class="font-medium text-sm">渠道类型</label><select name="channelType" class="border rounded-lg px-4 py-2 w-full mt-1"><option disabled selected>请选择</option><option>验证码短信渠道</option><option>通知类短信渠道</option></select></div>
                <div><label class="font-medium text-sm">发送方式</label><select name="sendType" class="border rounded-lg px-4 py-2 w-full mt-1"><option>及时触发</option><option>定时触发</option></select></div>
                <div><label class="font-medium text-sm">模板内容</label><textarea name="templateContent" rows="4" placeholder="请输入，使用{变量名}作为占位符" class="border rounded-lg px-4 py-2 w-full mt-1"></textarea></div>
                <div class="flex items-center pt-2"><label class="font-medium text-sm mr-4">状态</label><label class="switch"><input type="checkbox" name="status" checked><span class="slider"></span></label><span class="ml-2 text-gray-600">开启</span></div>
            </form>
            <div class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('appSmsModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="richTextConfigModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl h-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b"><h2 id="richTextConfigModalTitle" class="text-2xl font-bold text-gray-800">编辑配置项</h2><button onclick="hideModal('richTextConfigModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <div class="flex-grow p-4 modal-content-area"><div id="config-editor-container" class="bg-white border rounded-lg h-full"></div></div>
            <div id="richTextConfigModalButtons" class="flex justify-end p-4 border-t bg-gray-50 space-x-3">
                <button onclick="hideModal('richTextConfigModal')" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="textareaConfigModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl">
            <h2 id="textareaConfigModalTitle" class="text-2xl font-bold text-gray-800 mb-6">编辑配置项</h2>
            <div><label for="textareaModalContent" class="font-medium text-sm text-gray-700">内容</label><textarea id="textareaModalContent" rows="8" class="border rounded-lg px-4 py-2 w-full mt-1"></textarea></div>
            <div id="textareaConfigModalButtons" class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('textareaConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="contactConfigModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="contactConfigModalTitle" class="text-2xl font-bold text-gray-800 mb-6">编辑配置项</h2>
            <div class="space-y-4">
                <div><label for="contactPhone" class="font-medium text-sm text-gray-700">客服电话</label><input type="text" id="contactPhone" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                <div><label for="contactEmail" class="font-medium text-sm text-gray-700">客服邮箱</label><input type="email" id="contactEmail" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
            </div>
            <div id="contactConfigModalButtons" class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('contactConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="thresholdConfigModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <h2 id="thresholdConfigModalTitle" class="text-2xl font-bold text-gray-800 mb-6">编辑配置项</h2>
            <div>
                <label id="thresholdConfigModalLabel" class="font-medium text-sm text-gray-700">配置值</label>
                <div class="flex items-center mt-1">
                    <input type="number" id="thresholdConfigModalInput" class="border rounded-l-lg px-4 py-2 w-full">
                    <span id="thresholdConfigModalSuffix" class="bg-gray-200 text-gray-700 px-4 py-2 border border-l-0 rounded-r-lg"></span>
                </div>
            </div>
            <div id="thresholdConfigModalButtons" class="flex justify-end mt-8 space-x-3">
                <button onclick="hideModal('thresholdConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>
            </div>
        </div>
    </div>
    <div id="announcementModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl h-full max-h-[95vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b"><h2 id="announcementModalTitle" class="text-2xl font-bold text-gray-800">发布新公告</h2><button onclick="hideModal('announcementModal')" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <div class="flex-grow p-6 modal-content-area space-y-4">
                 <div><label class="font-medium text-sm">公告标题</label><input type="text" placeholder="请输入公告标题" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                 <div class="grid grid-cols-2 gap-6">
                    <div><label class="font-medium text-sm">公告类型</label><select class="border rounded-lg px-4 py-2 w-full mt-1"><option>平台公告</option><option>活动通知</option><option>系统维护</option></select></div>
                    <div><label class="font-medium text-sm">排序值</label><input type="number" value="0" placeholder="数字越大，排序越靠前" class="border rounded-lg px-4 py-2 w-full mt-1"></div>
                 </div>
                 <div class="flex-grow flex flex-col"><label class="font-medium text-sm mb-1">公告内容</label><div id="announcement-editor-container" class="bg-white border rounded-lg flex-grow"></div></div>
                 <div>
                    <label class="font-medium text-sm">发布时间</label>
                    <div class="flex items-center space-x-6 mt-2">
                        <label class="flex items-center"><input type="radio" name="announceTime" value="now" checked class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">立即发布</span></label>
                        <label class="flex items-center"><input type="radio" name="announceTime" value="scheduled" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">定时发布</span></label>
                    </div>
                    <div id="announce-scheduled-time-group" class="mt-2 hidden"><input type="datetime-local" class="border rounded-lg px-4 py-2"></div>
                </div>
            </div>
            <div id="announcementModalButtons" class="flex justify-end p-4 border-t bg-gray-50 space-x-3">
                <button onclick="hideModal('announcementModal')" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button>
                <button class="bg-yellow-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-yellow-600">保存草稿</button>
                <button class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700">发布公告</button>
            </div>
        </div>
    </div>
    
<script>
    // --- Login Logic ---
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const captcha = document.getElementById('captcha').value;
        if (!username || !password || !captcha) {
            alert('账号、密码和验证码不能为空！');
            return;
        }
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('app-container').style.display = 'flex';
        lucide.createIcons();
        initializeActivePage(); 
    }
    
    function logout(event) {
        if(event) event.preventDefault();
        document.getElementById('app-container').style.display = 'none';
        document.getElementById('login-page').style.display = 'flex';
        document.getElementById('username').value = "admin_manager";
        document.getElementById('password').value = "password123";
        document.getElementById('captcha').value = "r8xT";
    }

    // --- Core Application Logic ---
    const allPages = document.querySelectorAll('.page');
    const allLinks = document.querySelectorAll('#sidebar-nav a');
    
    function showPage(pageId, element) {
        if (event) event.preventDefault();
        allPages.forEach(p => { p.style.display = 'none'; });
        const targetPage = document.getElementById(pageId);
        if (targetPage) { targetPage.style.display = 'block'; }
        
        allLinks.forEach(l => l.classList.remove('active', 'active-parent'));
        if (element) {
            element.classList.add('active');
            const parentItem = element.closest('.sidebar-item');
            if (parentItem) {
                document.querySelectorAll('.sidebar-item.open').forEach(item => { if(item !== parentItem.closest('.sidebar-item')) item.classList.remove('open'); });
                if (parentItem.querySelector('.submenu')) {
                     parentItem.classList.add('open');
                }
                const parentLink = parentItem.querySelector('a:not(.submenu a)');
                if (parentLink && parentLink !== element) { parentLink.classList.add('active-parent'); }
            }
        }
    }

    function toggleSubmenu(element) {
        event.preventDefault();
        const parentItem = element.closest('.sidebar-item');
        if (parentItem) {
            if(parentItem.querySelector('.submenu')) { parentItem.classList.toggle('open'); } 
            else { 
                 const pageId = element.getAttribute('onclick').match(/'([^']+)'/)[1];
                 showPage(pageId, element);
            }
        }
    }

    function showModal(modalId) { 
        const modal = document.getElementById(modalId);
        if (modal) modal.style.display = 'flex'; 
    }

    function hideModal(modalId) { 
        const modal = document.getElementById(modalId);
        if (modal) modal.style.display = 'none';
        if (modalId === 'templateEditorModal' && quill) { quill.setContents([]); }
        if (modalId === 'richTextConfigModal' && configQuill) { configQuill.setContents([]); }
        if (modalId === 'announcementModal' && announcementQuill) { announcementQuill.setContents([]); }
    }

    function initializeActivePage() {
        const activeLink = document.querySelector('#sidebar-nav a.active');
        if (activeLink) {
             const pageIdMatch = activeLink.getAttribute('onclick').match(/'([^']+)'/);
             if (pageIdMatch && pageIdMatch[1]) {
                 showPage(pageIdMatch[1], activeLink);
             }
        } else {
            showPage('dashboard', document.querySelector('#sidebar-nav a[onclick*="dashboard"]'));
        }
    }
    
    // --- User Dropdown Logic ---
    function toggleUserDropdown() {
        const menu = document.getElementById('user-dropdown-menu');
        menu.classList.toggle('hidden');
    }

    // --- Quill Editors Logic ---
    let quill = null; 
    let configQuill = null;
    let announcementQuill = null;
    function initializeQuillEditor() { if (!document.getElementById('editor-container')?.querySelector('.ql-toolbar')) { quill = new Quill('#editor-container', { theme: 'snow', modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'strike'], [{ 'list': 'ordered'}, { 'list': 'bullet' }], [{ 'color': [] }, { 'background': [] }], ['link'], ['clean']] } }); } }
    function initializeConfigQuillEditor() { if (!document.getElementById('config-editor-container')?.querySelector('.ql-toolbar')) { configQuill = new Quill('#config-editor-container', { theme: 'snow', modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'strike'], [{ 'list': 'ordered'}, { 'list': 'bullet' }], [{ 'color': [] }, { 'background': [] }], ['link'], ['clean']] } }); } }
    function initializeAnnouncementQuillEditor() { if (!document.getElementById('announcement-editor-container')?.querySelector('.ql-toolbar')) { announcementQuill = new Quill('#announcement-editor-container', { theme: 'snow', placeholder: '在此输入公告详细内容...', modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'strike'], [{ 'list': 'ordered'}, { 'list': 'bullet' }], [{ 'color': [] }, { 'background': [] }], ['link', 'image'], ['clean']] } }); } }

    // --- Role Management Logic ---
    const permissionData = [
        { module: '仪表盘', pages: [{ name: '仪表盘', actions: ['查看'] }] },
        { module: '客户管理', pages: [{ name: '客户管理', actions: ['查看', '显示Key'] }] },
        { module: '操盘手管理', pages: [{ name: '操盘手列表', actions: ['查看', '新增', '编辑'] }, { name: '入驻审核', actions: ['查看', '通过', '拒绝'] }] },
        { module: '合同管理', pages: [{ name: '合同列表', actions: ['查看', '筛选'] }, { name: '合同模板管理', actions: ['查看', '创建', '编辑', '删除'] }] },
        { module: '收益管理', pages: [{ name: '平台收益总览', actions: ['查看', '导出'] }, { name: '客户收益结算', actions: ['查看', '核销', '详情'] }, { name: '操盘手收益结算', actions: ['查看', '支付', '详情'] }] },
        { module: '系统配置', pages: [ { name: '账号管理', actions: ['查看', '新增', '编辑', '重置密码'] }, { name: '角色管理', actions: ['查看', '新增', '编辑'] }, { name: '短信渠道配置', actions: ['查看', '新增', '编辑', '删除'] }, { name: 'APP短信配置', actions: ['查看', '新增', '编辑', '删除'] }, { name: 'APP配置', actions: ['查看', '编辑'] }, { name: '消息管理', actions: ['查看', '发布', '编辑', '下线', '推送'] } ] },
        { module: '风控与日志', pages: [{ name: '异常交易监控', actions: ['查看', '处理'] }, { name: 'API Key监控', actions: ['查看'] }, { name: '操作日志', actions: ['查看', '搜索'] }] }
    ];

    function buildPermissionTree(data, isDisabled = false) {
        let html = '<ul>';
        data.forEach(module => {
            html += `<li><span class="module-name">${module.module}</span><ul>`;
            module.pages.forEach(page => {
                html += `<li><span class="page-name">${page.name}</span><div class="actions-list">`;
                page.actions.forEach(action => {
                    html += `<label class="flex items-center space-x-2"><input type="checkbox" ${isDisabled ? 'disabled' : ''}><span>${action}</span></label>`;
                });
                html += `</div></li>`;
            });
            html += '</ul></li>';
        });
        html += '</ul>';
        return html;
    }

    function openRoleModal(mode, btn) {
        const modal = document.getElementById('roleModal');
        const title = document.getElementById('roleModalTitle');
        const confirmBtn = document.getElementById('roleModalConfirmBtn');
        const treeContainer = document.getElementById('permissionTreeContainer');
        const roleNameInput = document.getElementById('roleNameInput');
        const roleDescInput = document.getElementById('roleDescInput');

        roleNameInput.value = '';
        roleDescInput.value = '';
        roleNameInput.disabled = false;
        roleDescInput.disabled = false;
        confirmBtn.style.display = 'block';

        if (mode === 'add') {
            title.textContent = '新增角色';
            treeContainer.innerHTML = buildPermissionTree(permissionData, false);
        } else {
            const row = btn.closest('tr');
            const roleName = row.cells[0].textContent;
            const roleDesc = row.cells[1].textContent;
            roleNameInput.value = roleName;
            roleDescInput.value = roleDesc;
            
            roleNameInput.disabled = true;

            if (mode === 'edit') {
                title.textContent = '编辑角色';
                treeContainer.innerHTML = buildPermissionTree(permissionData, false);
                treeContainer.querySelectorAll('input[type="checkbox"]').forEach((box, index) => {
                    if (roleName === '超级管理员') box.checked = true;
                    if (roleName === '运营人员' && index < 20) box.checked = true;
                    if (roleName === '操盘手' && index < 5) box.checked = true;
                });
            } else if (mode === 'view') {
                title.textContent = '角色权限详情';
                roleDescInput.disabled = true;
                confirmBtn.style.display = 'none';
                treeContainer.innerHTML = buildPermissionTree(permissionData, true);
                 treeContainer.querySelectorAll('input[type="checkbox"]').forEach((box, index) => {
                    if (roleName === '超级管理员') box.checked = true;
                    if (roleName === '运营人员' && index < 20) box.checked = true;
                    if (roleName === '操盘手' && index < 5) box.checked = true;
                });
            }
        }
        showModal('roleModal');
    }

    // --- All Other Modal Openers ---
    function openAccountModal(isEdit = false, btn) {
        const modal = document.getElementById('accountModal');
        const title = document.getElementById('accountModalTitle');
        const form = document.getElementById('accountModalForm');
        title.textContent = isEdit ? '编辑账号' : '新增账号';
        form.reset();
        showModal('accountModal');
    }
    function openSmsChannelModal(isEdit, btn) {
        const modal = document.getElementById('smsChannelModal');
        const title = document.getElementById('smsChannelModalTitle');
        const form = document.getElementById('smsChannelModalForm');
        form.reset();
        title.textContent = isEdit ? '编辑短信渠道' : '新增短信渠道';
        showModal('smsChannelModal');
    }
    function openAppSmsModal(isEdit, btn) {
        const modal = document.getElementById('appSmsModal');
        const title = document.getElementById('appSmsModalTitle');
        const form = document.getElementById('appSmsModalForm');
        form.reset();
        title.textContent = isEdit ? '编辑短信配置' : '新增短信配置';
        showModal('appSmsModal');
    }
    function openBillDetailModal() { showModal('billDetailModal'); }
    function openVerificationModal() { showModal('verificationModal'); }
    function openTraderBillDetailModal() { showModal('traderBillDetailModal'); }
    function openInitiatePaymentModal() { showModal('initiatePaymentModal'); }
    function openTemplateEditor(isEditMode = false, buttonElement = null) {
        const editorModal = document.getElementById('templateEditorModal');
        if(!editorModal) return;
        showModal('templateEditorModal');
        setTimeout(() => {
            initializeQuillEditor();
            const modalTitle = editorModal.querySelector('#templateEditorTitle');
            const nameInput = editorModal.querySelector('#templateNameInput');
            if (isEditMode && buttonElement) {
                modalTitle.textContent = '编辑合同模板';
                const row = buttonElement.closest('tr');
                nameInput.value = row.querySelector('.template-name').textContent;
                quill.root.innerHTML = row.querySelector('.template-full-content').innerHTML;
            } else {
                modalTitle.textContent = '创建新模板';
                nameInput.value = '';
                quill.setContents([]); 
            }
        }, 10);
    }
    function openAnnouncementModal(isEdit = false) {
        const modal = document.getElementById('announcementModal');
        const title = document.getElementById('announcementModalTitle');
        title.textContent = isEdit ? '编辑公告' : '发布新公告';
        showModal('announcementModal');
        setTimeout(() => {
            initializeAnnouncementQuillEditor();
        }, 10);
    }
    const appConfigData = {
        about: { title: '关于我们', content: `币联是一个安全、透明、合规的资产增值服务平台，致力于为全球用户提供专业的数字资产管理方案。\n我们拥有顶尖的金融科技团队和严格的风控体系，确保客户资产安全与稳定增值。` },
        contact: { title: '联系我们', phone: '400-800-8888', email: 'support@coinlink.com' },
        userAgreement: { title: '用户协议', content: '<h1>第一条 总则</h1><p>1.1 本协议旨在明确用户在使用币联服务时的权利与义务，是规范双方行为的法律文件。</p><p>1.2 用户在注册过程中点击“同意”按钮即表示完全接受本协议项下的全部条款。</p><h2>第二条 服务内容</h2><p>...</p>' },
        privacyPolicy: { title: '隐私协议', content: '<h1>引言</h1><p>我们非常重视您的个人信息和隐私保护，并承诺将按照本隐私政策的规定收集、使用、储存您的个人信息。</p><h2>信息收集范围</h2><p>...</p>' },
        liveness: { title: '活体阈值', label: '通过率', value: 75, suffix: '%' },
        one_to_one: { title: '1:1阈值', label: '通过率', value: 75, suffix: '%' },
        ocr: { title: 'OCR阈值', label: '单用户每日调用次数', value: 10, suffix: '次' },
        esign: { title: '电子签字配置', label: '单用户每日调用次数', value: 10, suffix: '次' }
    };
    function openConfigModal(mode, configType) {
        const isView = mode === 'view';
        const data = appConfigData[configType];
        if (!data) return;

        if (configType === 'about') {
            const modal = document.getElementById('textareaConfigModal');
            modal.querySelector('#textareaConfigModalTitle').textContent = (isView ? '查看' : '编辑') + ' - ' + data.title;
            const content = modal.querySelector('#textareaModalContent');
            content.value = data.content;
            content.disabled = isView;
            modal.querySelector('#textareaConfigModalButtons').innerHTML = isView ? `<button onclick="hideModal('textareaConfigModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">关闭</button>` : `<button onclick="hideModal('textareaConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>`;
            showModal('textareaConfigModal');
        } else if (configType === 'contact') {
            const modal = document.getElementById('contactConfigModal');
            modal.querySelector('#contactConfigModalTitle').textContent = (isView ? '查看' : '编辑') + ' - ' + data.title;
            const phone = modal.querySelector('#contactPhone');
            const email = modal.querySelector('#contactEmail');
            phone.value = data.phone;
            email.value = data.email;
            phone.disabled = isView;
            email.disabled = isView;
            modal.querySelector('#contactConfigModalButtons').innerHTML = isView ? `<button onclick="hideModal('contactConfigModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">关闭</button>` : `<button onclick="hideModal('contactConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>`;
            showModal('contactConfigModal');
        } else if (configType === 'userAgreement' || configType === 'privacyPolicy') {
            const modal = document.getElementById('richTextConfigModal');
            showModal('richTextConfigModal');
            setTimeout(() => {
                initializeConfigQuillEditor();
                modal.querySelector('#richTextConfigModalTitle').textContent = (isView ? '查看' : '编辑') + ' - ' + data.title;
                configQuill.root.innerHTML = data.content;
                configQuill.enable(!isView);
                modal.querySelector('#richTextConfigModalButtons').innerHTML = isView ? `<button onclick="hideModal('richTextConfigModal')" class="bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold hover:bg-gray-300">关闭</button>` : `<button onclick="hideModal('richTextConfigModal')" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button><button class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>`;
            }, 10);
        } else { // Thresholds
            const modal = document.getElementById('thresholdConfigModal');
            modal.querySelector('#thresholdConfigModalTitle').textContent = (isView ? '查看' : '编辑') + ' - ' + data.title;
            const label = modal.querySelector('#thresholdConfigModalLabel');
            const input = modal.querySelector('#thresholdConfigModalInput');
            const suffix = modal.querySelector('#thresholdConfigModalSuffix');
            label.textContent = data.label;
            input.value = data.value;
            suffix.textContent = data.suffix;
            input.disabled = isView;
            modal.querySelector('#thresholdConfigModalButtons').innerHTML = isView ? `<button onclick="hideModal('thresholdConfigModal')" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">关闭</button>` : `<button onclick="hideModal('thresholdConfigModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">取消</button><button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700">确认</button>`;
            showModal('thresholdConfigModal');
        }
    }

    // --- Tab Switching Logic ---
    function switchTab(containerId, buttonPrefix, panePrefix, tabName) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.querySelectorAll(`.${buttonPrefix}`).forEach(button => button.classList.remove('active'));
        container.querySelectorAll(`.${panePrefix}`).forEach(pane => pane.classList.remove('active'));
        container.querySelector(`#tab-btn-${tabName}`).classList.add('active');
        container.querySelector(`#tab-pane-${tabName}`).classList.add('active');
    }

    function switchContentTab(tabName) {
        switchTab('settings-content', 'tab-button', 'tab-pane', tabName);
    }

    function switchTraderAppTab(tabName) {
        switchTab('trader-applications', 'tab-button', 'tab-pane', tabName);
    }
    
    // --- Page-specific initializations ---
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        
        // Charts
        const aumCtx = document.getElementById('aumTrendChart');
        if (aumCtx) { new Chart(aumCtx.getContext('2d'), { type: 'line', data: { labels: ['10-01', '10-04', '10-07', '10-10', '10-13', '10-16', '10-19', '10-22', '10-25', '10-28', '10-31'], datasets: [{ label: 'AUM ($)', data: [1150000, 1165000, 1180000, 1175000, 1210000, 1230000, 1225000, 1250000, 1270000, 1265000, 1283450], backgroundColor: 'rgba(79, 70, 229, 0.1)', borderColor: '#4f46e5', tension: 0.4, fill: true, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { callback: (value) => `${value / 1000}k` } } } } }); }
        const profitCtx = document.getElementById('profitTrendChart');
        if (profitCtx) { new Chart(profitCtx.getContext('2d'), { type: 'bar', data: { labels: ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'], datasets: [ { label: '总收入', data: [55, 62, 78, 75, 92, 85], backgroundColor: '#22c55e' }, { label: '总支出', data: [16, 18, 23, 22, 27, 25], backgroundColor: '#ef4444' } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { ticks: { callback: (value) => `${value}k` } } } } }); }
        const revenueCtx = document.getElementById('revenueSourceChart');
        if (revenueCtx) { new Chart(revenueCtx.getContext('2d'), { type: 'doughnut', data: { labels: ['稳健猎手', '激进先锋', '趋势之王', '其他'], datasets: [{ data: [40, 30, 20, 10], backgroundColor: ['#4f46e5', '#34d399', '#f59e0b', '#9ca3af'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } }); }

        // Customer Key Logic
        const customerTableBody = document.getElementById('customer-table-body');
        if (customerTableBody) {
            customerTableBody.addEventListener('click', function(e) {
                if (e.target.classList.contains('show-key-btn')) {
                    const btn = e.target;
                    const tr = btn.closest('tr');
                    const apiKeyContainer = tr.querySelector('.api-key-container');
                    const secretKeyContainer = tr.querySelector('.secret-key-container');
                    if (btn.textContent === '显示Key') {
                        const password = prompt("为安全起见，请输入登录密码以查看Key：");
                        if (password) { // simplified check
                            const apiKey = tr.dataset.apiKey;
                            const secretKey = tr.dataset.secretKey;
                            apiKeyContainer.innerHTML = `<div class="flex items-center space-x-2"><span class="font-mono text-sm">${apiKey}</span><i data-lucide="copy" class="h-4 w-4 text-gray-500 hover:text-indigo-600 cursor-pointer copy-icon" title="复制"></i></div>`;
                            secretKeyContainer.innerHTML = `<div class="flex items-center space-x-2"><span class="font-mono text-sm">${secretKey}</span><i data-lucide="copy" class="h-4 w-4 text-gray-500 hover:text-indigo-600 cursor-pointer copy-icon" title="复制"></i></div>`;
                            btn.textContent = '隐藏Key';
                            lucide.createIcons();
                        }
                    } else {
                        apiKeyContainer.innerHTML = `<span class="font-mono text-sm">************</span>`;
                        secretKeyContainer.innerHTML = `<span class="font-mono text-sm">************</span>`;
                        btn.textContent = '显示Key';
                    }
                }
                if (e.target.closest('.copy-icon')) {
                    const icon = e.target.closest('.copy-icon');
                    const keyText = icon.previousElementSibling.textContent;
                    navigator.clipboard.writeText(keyText).then(() => { alert(`'${keyText.substring(0,10)}...' 已复制到剪贴板!`); }).catch(err => { console.error('无法复制: ', err); alert('复制失败!'); });
                }
            });
        }
        
        // Trader Modal Logic
        window.openTraderModal = function(isEditMode, buttonElement) {
             const modal = document.getElementById('addTraderModal');
             if(!modal) return;
             const modalTitle = modal.querySelector('#traderModalTitle');
             const modalForm = modal.querySelector('#traderModalForm');
             if (isEditMode && buttonElement) {
                 modalTitle.textContent = '编辑操盘手';
                 const row = buttonElement.closest('tr');
                 modalForm.name.value = row.querySelector('.trader-name').textContent;
                 modalForm.phone.value = row.querySelector('.trader-phone').textContent;
                 modalForm.company.value = row.querySelector('.trader-company').textContent;
                 modalForm.nickname.value = row.querySelector('.trader-nickname').textContent;
                 modalForm.style.value = row.querySelector('.trader-style').textContent;
                 modalForm.experience.value = row.querySelector('.trader-experience').textContent;
                 modalForm.min_investment.value = row.querySelector('.trader-min-investment').textContent;
                 modalForm.bio.value = row.querySelector('.table-description').getAttribute('title');
             } else {
                 modalTitle.textContent = '新增操盘手';
                 modalForm.reset();
             }
             showModal('addTraderModal');
        }
        const traderTable = document.getElementById('trader-table');
        if (traderTable) {
            traderTable.addEventListener('click', (e) => {
                if (e.target.classList.contains('edit-trader-btn')) {
                    openTraderModal(true, e.target);
                }
            });
        }

        // Quill variables logic
        const variablesContainer = document.getElementById('variable-tags-container');
        if (variablesContainer) { variablesContainer.addEventListener('click', (e) => { if (e.target.classList.contains('variable-tag') && quill) { const variableText = e.target.textContent; const range = quill.getSelection(true); quill.insertText(range.index, ` ${variableText} `, 'user'); quill.setSelection(range.index + variableText.length + 2); } }); }
        
        // Form radio button logic
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.name === 'pushTarget') {
                    document.getElementById('specific-user-group').style.display = this.value === 'specific' ? 'block' : 'none';
                }
                if (this.name === 'pushTime') {
                    document.getElementById('scheduled-time-group').style.display = this.value === 'scheduled' ? 'block' : 'none';
                }
                if (this.name === 'announceTime') {
                    document.getElementById('announce-scheduled-time-group').style.display = this.value === 'scheduled' ? 'block' : 'none';
                }
            });
        });

        // Close dropdown when clicking outside
        window.addEventListener('click', function(e) {
            const dropdownContainer = document.getElementById('user-dropdown-container');
            if (dropdownContainer && !dropdownContainer.contains(e.target)) {
                document.getElementById('user-dropdown-menu').classList.add('hidden');
            }
        });
    });
</script>

</body>
</html>